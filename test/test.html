<html>
	<head>
		<script src="../build/amd.js"></script>
		<script>
			require.config({
				waitSeconds: 7,
				baseUrl: '../build/',
				paths: {
					test: 'test',
					a: '../test/bundle',
					b: '../test/bundle'
				}
			});
			define('outside', [], function () { return 'Outside'; })

			require(['test', 'a', 'b', 'outside', 'transducers', 'route'], function (t, a, b, outside, _, route) {
				route.ready(function () {

					console.log('Loaded test');
					console.log(t.foo());
					console.log(a);
					console.log(b);
					console.log(outside);

					var process = _.filter(x => x <= 3).comp(
									_.map(x => x + 1)
									 .take(2))

					var routes = [
						route('#/a', () => { console.log('a!'); }),
						route('#/b', () => { console.log('b!'); }),
						route('*', () => { console.log('dunno'); }),
					];

					route.url.then(
						_.match(routes)
							.to(routeAction => routeAction()));

					var r = _.reduce([1, 2, 3, 4, 5, 6], process.to([]));
					console.log(r);

					//_.mapcat(t => _.delay(t, t))


					var s = _.reduce([1000, 300, 400, 2000],
								_.mapcat(t => _.delay(t, t), _.latest().wait())
									//.to(v => { console.log(v) }));
									.done(arr => console.log('done:', arr))
									//.post(v => console.log('post:', v))
									//.pre(v => console.log('pre:', v))
									.err(e => console.log(e))
									.to([]));

					//s.then(arr => console.log(arr));
				})
			});
		</script>
	</head>
	<body bgcolor="black"/>
</html>