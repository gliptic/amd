<html>
	<head>
		<script src="../build/amd.js"></script>
		<script>
			require.config({
				waitSeconds: 7,
				baseUrl: '../build/',
				paths: {
					test: 'test',
					a: '../test/bundle',
					b: '../test/bundle'
				}
			});
			define('outside', [], function () { return 'Outside'; })

			require(['test', 'a', 'b', 'outside', 'transducers', 'route'], function (t, a, b, outside, _, route) {
				route.ready(function () {

					console.log('Loaded test');
					console.log(t.foo());
					console.log(a);
					console.log(b);
					console.log(outside);

					var process = _.filter(x => x <= 3)
									.map(x => x + 1)
									.take(2)

					var routes = [
						route('/a', () => { console.log('a!'); }),
						route('/b', () => { console.log('b!'); }),
						route('*', () => { console.log('dunno'); }),
					];

					route.url
						.match(routes)
						.to(routeAction => routeAction());

					var r = _([1, 2, 3, 4, 5, 6]).comp(process).to([]);
					console.log(r);

					var l = _([1, 2, 3]).drop(1).lazy();
					console.log(l.next());

					//_.mapcat(t => _.delay(t, t))

					function regEvent(node, eventName) {
						var s = _.sig();
						var f = e => {
							if (s.r(e)) {
								console.log('Unregistering');
								node.removeEventListener(eventName, f);
							}
						};
						node.addEventListener(eventName, f);
						return s;
					}

					var e = regEvent(document, 'click');

					e.take(5)
					 .timeInterval()
					 .done(arr => console.log('Click intervals:', _(arr).map(x => x.interval).to([])))
				     .to([], _.wait());

			        e.some = null;

/*
					_([1000, 300, 400, 2000])
						.mapcat(t => _.after(t, t), _.wait())
						.done(arr => console.log('done:', arr))
						.err(e => console.log(e))
						.to(x => { console.log(x); });*/

					//s.then(arr => console.log(arr));
				})
			});
		</script>
	</head>
	<body bgcolor="black"/>
</html>